/* eslint-disable no-unused-vars */
/* eslint-disable no-trailing-spaces */
// This file is auto-generated by generate_classes so do not edit manually
{% macro lower_case_first_letter(text) %}
    {{- text[0]|lower }}{{ text[1:] -}}
{% endmacro %}
{% macro upper_case_first_letter(text) %}
    {{- text[0]|upper }}{{ text[1:] -}}
{% endmacro %}

{% if fhir_entity.cleaned_name == 'Resource' %}
const ResourceContainer = require('../simple_types/resourceContainer');
{%  elif fhir_entity.is_resource %}
const Resource = require('../resources/resource');
{% elif fhir_entity.cleaned_name == 'Element' %}
const Resource = require('../resources/resource');
{%  else %}
const Element = require('../complex_types/element');
const Resource = require('../resources/resource');
{%  endif %}
const async = require('async');


/**
{{ fhir_entity.fhir_name }}
{% for documentation_item in fhir_entity.documentation %}
    {{ documentation_item | wordwrap(78) | replace('\n', '\n    ') | replace('\r', '\n    ') }}
{% endfor %}
*/
{% if fhir_entity.cleaned_name == 'Resource' %}
class {{ fhir_entity.cleaned_name }} extends ResourceContainer {
{%  elif fhir_entity.is_resource %}
class {{ fhir_entity.cleaned_name }} extends Resource {
{% elif fhir_entity.cleaned_name == 'Element' %}
class {{ fhir_entity.cleaned_name }} {
{%  else %}
class {{ fhir_entity.cleaned_name }} extends Element {
{%  endif %}
    /**
{% for property in fhir_entity.properties %}
{% if not property.is_v2_supported %}
     * @param {{- ' {' -}}
    {% if property.cleaned_type == "Extension" %}
        {{- 'Extension' -}}
    {% elif property.is_code %}
        {{- 'code' -}}
    {% else %}
        {{- property.cleaned_type | replace(".","") -}}
    {% endif %}
    {% if property.is_list -%}
        {{ '[]' -}}
    {% endif -%}
    {% if property.optional -%}
        {{ '|undefined' -}}
    {% endif %}
    {{- '} ' -}}
    {% if property.optional -%}
        {{ '[' -}}
    {% endif %}
    {{- property.javascript_clean_name -}}
    {% if property.optional -%}
        {{ ']' -}}
    {% endif %},
{% endif %}
{%  endfor %}
{% for extra_property in extra_properties %}
     * @param {{- ' {' -}}
    {{ extra_property.type }}|undefined
    {{- '} ' -}}
    [{{ extra_property.name }}]
{%  endfor %}
{% if fhir_entity.cleaned_name == "Reference"  %}
    {% for extra_property in extra_properties_for_reference %}
     * @param {{- ' {' -}}
    {{ extra_property.type }}|undefined
    {{- '} ' -}}
    [{{ extra_property.name }}]
    {%  endfor %}
{%  endif %}
    */
    constructor(
        {
{% for property in fhir_entity.properties %}
{% if not property.is_v2_supported %}
    {%  if property.name != property.javascript_clean_name %}
            '{{ property.name -}}': {{ property.javascript_clean_name -}},
    {%  else %}
            {{ property.name -}},
    {%  endif %}
{% endif %}
{% endfor %}
{% for extra_property in extra_properties %}
            {{ extra_property.name -}},
{%  endfor %}
{% if fhir_entity.cleaned_name == "Reference"  %}
    {% for extra_property in extra_properties_for_reference %}
            {{ extra_property.name -}},
    {%  endfor %}
{% endif %}
        }
    ) {
{% if fhir_entity.cleaned_name == 'Element' %}
        // Create an object to store all props
        Object.defineProperty(this, '__data', {
            value: {},
        });
{%  else %}
        super({});
{% endif %}

        // ---- Define getters and setters as enumerable ---

{% for property in fhir_entity.properties %}
{% if not property.is_v2_supported %}
        /**
         * @description {{ property.documentation[0] | wordwrap(78) | replace('\n', '\n    ') | replace('\r', '\n    ') }}
         * @property {{- ' {' -}}
    {% if property.cleaned_type == "Extension" %}
        {{- 'Extension' -}}
    {% elif property.is_code %}
        {{- 'code' -}}
    {% else %}
        {{- property.cleaned_type | replace(".","") -}}
    {% endif %}
    {% if property.is_list -%}
        {{ '[]' -}}
    {% endif -%}
    {% if property.optional -%}
        {{ '|undefined' -}}
    {% endif %}
    {{- '}' }}
        {{ '*/' }}
        Object.defineProperty(this, '{{ property.name -}}', {
            // https://www.w3schools.com/js/js_object_es5.asp
            enumerable: true,
            configurable: true,
            get: () => this.__data.{{ property.name -}},
            set: valueProvided => {
                if (valueProvided === undefined || valueProvided === null || (Array.isArray(valueProvided) && valueProvided.length === 0)) {
                    this.__data.{{ property.name }} = undefined;
                    return;
                }
    {% if property.is_resource %}
            {%  if property.cleaned_type != fhir_entity.cleaned_name %}
                const {{ property.cleaned_type | replace(".","") }} = require('../resources/{{ lower_case_first_letter(property.type_snake_case) }}.js');
            {%  endif %}
    {% elif property.is_code %}
    {% elif property.is_extension %}
            {%  if property.cleaned_type != fhir_entity.cleaned_name %}
                const {{ property.cleaned_type | replace(".","") }} = require('../complex_types/{{ lower_case_first_letter(property.type_snake_case) }}.js');
            {%  endif %}
    {% elif property.fhir_type == "BackboneElement" %}
            {%  if property.cleaned_type != fhir_entity.cleaned_name %}
                const {{ property.cleaned_type | replace(".","") }} = require('../backbone_elements/{{ lower_case_first_letter(property.type_snake_case) }}.js');
            {%  endif %}
    {% elif property.cleaned_type == "ResourceContainer" %}
            {%  if property.cleaned_type != fhir_entity.cleaned_name %}
                const {{ property.cleaned_type | replace(".","") }} = require('../simple_types/{{ lower_case_first_letter(property.type_snake_case) }}.js');
            {%  endif %}
    {% elif property.is_complex or property.fhir_type == "Element" %}
            {%  if property.cleaned_type != fhir_entity.cleaned_name %}
                const {{ property.cleaned_type | replace(".","") }} = require('../complex_types/{{ lower_case_first_letter(property.type_snake_case) }}.js');
            {%  endif %}
{#        {% elif property.type_snake_case in ["string", "boolean", "integer", "positiveInt"] %}#}
{#                this.__data.{{ property.name }} = value;#}
    {% endif %}
    {%  if property.is_resource or property.is_extension or property.fhir_type == "BackboneElement" or property.is_complex or property.fhir_type == "Element" %}
                const {FhirResourceCreator} = require('../../../fhirResourceCreator');
        {% if property.is_list %}
                this.__data.{{ property.name }} = FhirResourceCreator.createArray(valueProvided, {{ property.cleaned_type | replace(".","") }});
            {%  else %}
                this.__data.{{ property.name }} = FhirResourceCreator.create(valueProvided, {{ property.cleaned_type | replace(".","") }});
            {% endif %}
    {%  elif property.cleaned_type == "ResourceContainer" %}
                const {FhirResourceCreator} = require('../../../fhirResourceCreator');
        {% if property.is_list %}
                this.__data.{{ property.name }} = FhirResourceCreator.createArray(valueProvided);
            {%  else %}
                this.__data.{{ property.name }} = FhirResourceCreator.create(valueProvided);
            {% endif %}
    {%  else %}
            {% if property.is_list %}
                this.__data.{{ property.name }} = Array.isArray(valueProvided) ? valueProvided.filter(v => v).map(v => v) : [valueProvided];
            {%  else %}
                this.__data.{{ property.name }} = valueProvided;
            {% endif %}
    {%  endif %}
            }
        });

{% endif %}
{% endfor %}

{% for extra_property in extra_properties %}
        /**
         * @description {{ extra_property.name }}
         * @property {{ '{' + extra_property.type + '|undefined' +'}' }}
         */
        Object.defineProperty(this, '{{ extra_property.name -}}', {
            // https://www.w3schools.com/js/js_object_es5.asp
            enumerable: true,
            configurable: true,
            get: () => this.__data.{{ extra_property.name }},
            set: valueProvided => {
                this.__data.{{ extra_property.name }} = valueProvided;
            }
        });
{%  endfor %}

{% if fhir_entity.cleaned_name == "Reference"  %}
    {% for extra_property in extra_properties_for_reference %}
        /**
         * @description {{ extra_property.name }}
         * @property {{ '{' + extra_property.type + '|undefined' +'}' }}
         */
        Object.defineProperty(this, '{{ extra_property.name -}}', {
            // https://www.w3schools.com/js/js_object_es5.asp
            enumerable: true,
            configurable: true,
            get: () => this.__data.{{ extra_property.name }},
            set: valueProvided => {
                this.__data.{{ extra_property.name }} = valueProvided;
            }
        });
    {%  endfor %}
{%  endif %}

        // --- Now copy properties from passed in object ----
        Object.assign(this, {
{% for property in fhir_entity.properties %}
{% if not property.is_v2_supported %}
    {%  if property.name != property.javascript_clean_name %}
            '{{ property.name -}}': {{ property.javascript_clean_name -}},
    {%  else %}
            {{ property.name -}},
    {%  endif %}
{% endif %}
{% endfor %}
{% for extra_property in extra_properties %}
            {{ extra_property.name -}},
{% endfor %}
{% if fhir_entity.cleaned_name == "Reference"  %}
    {% for extra_property in extra_properties_for_reference %}
            {{ extra_property.name -}},
    {% endfor %}
{%  endif %}
        });

{% if fhir_entity.is_resource %}
        /**
         * @description Define a default non-writable resourceType property
         * @property {string|undefined}
         */
        Object.defineProperty(this, 'resourceType', {
            value: '{{ fhir_entity.cleaned_name }}',
            enumerable: true,
            writable: false,
            configurable: true
        });
{%  endif %}
    }

{% if fhir_entity.is_resource %}
    /**
     * @description Define a default non-writable resourceType property
     * @property {string|undefined}
     */
    static get resourceType() {
        return '{{ fhir_entity.cleaned_name }}';
    }
{%  endif %}

{% if fhir_entity.is_resource %}
    /**
     * @description Creates a blank new resource
{% for property in fhir_entity.properties %}
{% if not property.is_v2_supported %}
     * @param {{- ' {' -}}
    {% if property.cleaned_type == "Extension" %}
        {{- 'Extension' -}}
    {% elif property.is_code %}
        {{- 'code' -}}
    {% else %}
        {{- property.cleaned_type | replace(".","") -}}
    {% endif %}
    {% if property.is_list -%}
        {{ '[]' -}}
    {% endif -%}
    {% if property.optional -%}
        {{ '|undefined' -}}
    {% endif %}
    {{- '} ' -}}
    {% if property.optional -%}
        {{ '[' -}}
    {% endif %}
    {{- property.javascript_clean_name -}}
    {% if property.optional -%}
        {{ ']' -}}
    {% endif %},
{% endif %}
{%  endfor %}
{% for extra_property in extra_properties %}
     * @param {{- ' {' -}}
    {{ extra_property.type }}|undefined
    {{- '} ' -}}
    [{{ extra_property.name }}]
{%  endfor %}
{% if fhir_entity.cleaned_name == "Reference"  %}
    {% for extra_property in extra_properties_for_reference %}
     * @param {{- ' {' -}}
    {{ extra_property.type }}|undefined
    {{- '} ' -}}
    [{{ extra_property.name }}]
    {%  endfor %}
{% endif %}
     * @returns {{- ' {' -}}{{ fhir_entity.cleaned_name }} {{- '}' }}
    */
    create(
            {
{% for property in fhir_entity.properties %}
{% if not property.is_v2_supported %}
    {%  if property.name != property.javascript_clean_name %}
            '{{ property.name -}}': {{ property.javascript_clean_name -}},
    {%  else %}
            {{ property.name -}},
    {%  endif %}
{% endif %}
{% endfor %}
{% for extra_property in extra_properties %}
            {{ extra_property.name -}},
{% endfor %}
{% if fhir_entity.cleaned_name == "Reference"  %}
    {% for extra_property in extra_properties_for_reference %}
            {{ extra_property.name -}},
    {% endfor %}
{% endif %}
        }
    ) {
        return new {{ fhir_entity.cleaned_name }}({
{% for property in fhir_entity.properties %}
{% if not property.is_v2_supported %}
    {%  if property.name != property.javascript_clean_name %}
            '{{ property.name -}}': {{ property.javascript_clean_name -}},
    {%  else %}
            {{ property.name -}},
    {%  endif %}
{% endif %}
{% endfor %}
{% for extra_property in extra_properties %}
            {{ extra_property.name -}},
{% endfor %}
{% if fhir_entity.cleaned_name == "Reference"  %}
    {% for extra_property in extra_properties_for_reference %}
            {{ extra_property.name -}},
    {% endfor %}
{%  endif %}
        });
    }

    /**
     * @description creates a copy of this resource
     * @returns {{- ' {' -}}{{ fhir_entity.cleaned_name }} {{- '}' }}
    */
    clone() {
        return new {{ fhir_entity.cleaned_name }}(this.toJSONInternal());
    }

{%  endif %}

    /**
     * Returns JSON representation of entity
     * @return {Object}
     */
    toJSON() {
        const {removeNull} = require('../../../../utils/nullRemover');

        return removeNull({
        {% if fhir_entity.is_resource %}
            resourceType: this.resourceType,
        {%  endif %}
{% for property in fhir_entity.properties %}
{% if not property.is_v2_supported %}
    {%  if property.is_resource or property.is_extension or property.cleaned_type == "ResourceContainer" or property.fhir_type == "BackboneElement" or property.is_complex or property.fhir_type == "Element" %}
        {% if property.is_list %}
            {{ property.name -}}: this.{{ property.name }} && this.{{ property.name -}}.map(v => v.toJSON()),
        {%  else %}
            {{ property.name -}}: this.{{ property.name }} && this.{{ property.name -}}.toJSON(),
        {% endif %}
    {%  else %}
            {{ property.name -}}: this.{{ property.name -}},
    {% endif %}
{% endif %}
{% endfor %}
{% for extra_property in extra_properties_for_json %}
    {%  if extra_property.is_resource or extra_property.is_extension or extra_property.cleaned_type == "ResourceContainer" or extra_property.fhir_type == "BackboneElement" or extra_property.is_complex or extra_property.fhir_type == "Element" %}
        {% if extra_property.is_list %}
            {{ extra_property.name -}}: this.{{ extra_property.name }} && this.{{ extra_property.name -}}.map(v => v.toJSON()),
        {%  else %}
            {{ extra_property.name -}}: this.{{ extra_property.name }} && this.{{ extra_property.name -}}.toJSON(),
        {% endif %}
    {%  else %}
            {{ extra_property.name -}}: this.{{ extra_property.name -}},
    {% endif %}
{% endfor %}
        });
    }

    /**
     * Returns JSON representation of entity
     * @param {function(Reference): Promise<Reference>} fnUpdateReferenceAsync
     * @return {void}
     */
    async updateReferencesAsync({fnUpdateReferenceAsync}) {
{% if fhir_entity.cleaned_name == "Reference"  %}
        await fnUpdateReferenceAsync(this);
{% else %}
{% for property in fhir_entity.properties %}
{% if not property.is_v2_supported %}
    {%  if property.is_resource or property.is_extension or property.cleaned_type == "ResourceContainer" or property.fhir_type == "BackboneElement" or property.is_complex or property.fhir_type == "Element" %}
        {% if property.is_list %}
            if (this.{{ property.name }}) {await async.each(this.{{ property.name -}}, async v => await v.updateReferencesAsync({fnUpdateReferenceAsync}));}
        {%  else %}
            if (this.{{ property.name }}) {await this.{{ property.name -}}.updateReferencesAsync({fnUpdateReferenceAsync});}
        {% endif %}
    {% endif %}
{% endif %}
{% endfor %}
{% endif %}
    }

    /**
     * Returns JSON representation of entity
     * @return {Object}
     */
    toJSONInternal() {
        const {removeNull} = require('../../../../utils/nullRemover');
        const json = {
        {% if fhir_entity.is_resource %}
            resourceType: this.resourceType,
        {%  endif %}
{% for property in fhir_entity.properties %}
{% if not property.is_v2_supported %}
    {%  if property.is_resource or property.is_extension or property.cleaned_type == "ResourceContainer" or property.fhir_type == "BackboneElement" or property.is_complex or property.fhir_type == "Element" %}
        {% if property.is_list %}
            {{ property.name -}}: this.{{ property.name }} && this.{{ property.name -}}.map(v => v.toJSONInternal()),
        {%  else %}
            {{ property.name -}}: this.{{ property.name }} && this.{{ property.name -}}.toJSONInternal(),
        {% endif %}
    {%  else %}
            {{ property.name -}}: this.{{ property.name -}},
    {% endif %}
{% endif %}
{% endfor %}
        };


{% for extra_property in extra_properties %}
        if (this.{{ extra_property.name -}}) {
            json.{{ extra_property.name }} = this.{{ extra_property.name -}};
        }
{%  endfor %}
{% if fhir_entity.cleaned_name == "Reference"  %}
    {% for extra_property in extra_properties_for_reference %}
        if (this.{{ extra_property.name -}}) {
            json.{{ extra_property.name }} = this.{{ extra_property.name -}};
        }
    {%  endfor %}
{%  endif %}

        return removeNull(json);
    }
{% if fhir_entity.cleaned_name == "Resource"  %}

    /**
     * Returns a structure based on values in meta.security tags
     * @return {SecurityTagStructure}
     */
    get securityTagStructure() {
        const {SecurityTagStructure} = require('../../../securityTagStructure');
        return SecurityTagStructure.fromResource({resource: this});
    }

    /**
     * Returns whether two resources are same
     * @param {Resource|{resourceType: string, _uuid: string, id: string, securityTagStructure: SecurityTagStructure}} other
     * @return {boolean}
     */
    isSameResourceByIdAndSecurityTag({other}) {
        if (this.resourceType !== other.resourceType) {
            return false;
        }
        return (
            (this._uuid && (this._uuid === other._uuid)) || // either the uuid matches
            (
                // or id and sourceAssigningAuthority matches
                this.id === other.id &&
                this.securityTagStructure.matchesOnSourceAssigningAuthority(
                    {
                        other: other.securityTagStructure
                    }
                )
            )
        );
    }
{%  endif %}
}

module.exports = {{ fhir_entity.cleaned_name }};

